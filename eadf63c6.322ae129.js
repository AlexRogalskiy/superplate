(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{149:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return p})),n.d(t,"default",(function(){return b}));var a=n(3),r=n(7),i=(n(0),n(157)),o=n(161),s=n(162),c={id:"jest",title:"Jest",sidebar_label:"Jest",description:"Setting up Jest and Enzyme for Typescript Next.js apps"},l={unversionedId:"nextjs/testing/jest",id:"nextjs/testing/jest",isDocsHomePage:!1,title:"Jest",description:"Setting up Jest and Enzyme for Typescript Next.js apps",source:"@site/docs/nextjs/testing/jest.md",slug:"/nextjs/testing/jest",permalink:"/superplate/docs/nextjs/testing/jest",editUrl:"https://github.com/pankod/superplate/tree/master/documentation/docs/nextjs/testing/jest.md",version:"current",lastUpdatedBy:"\xd6mer Faruk APLAK",lastUpdatedAt:1620740656,sidebar_label:"Jest",sidebar:"someSidebar",previous:{title:"lint-staged",permalink:"/superplate/docs/nextjs/linter/lint-staged"},next:{title:"Testing Library",permalink:"/superplate/docs/nextjs/testing/testing-library"}},p=[{value:"Implementation",id:"implementation",children:[{value:"<code>jest.config.js</code>",id:"jestconfigjs",children:[]},{value:"<code>jest.setup.js</code>",id:"jestsetupjs",children:[]},{value:"Running Tests",id:"running-tests",children:[]},{value:"Example Test",id:"example-test",children:[]}]},{value:"Adding Jest to your project later",id:"adding-jest-to-your-project-later",children:[]}],u={toc:p};function b(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://jestjs.io/docs/en/getting-started"}),"Jest")," is a delightful JavaScript Testing Framework with a focus on simplicity."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"superplate")," serving optional Jest testing plugin which uses ",Object(i.b)("inlineCode",{parentName:"p"},"ts-jest")," under the hood and comes with ",Object(i.b)("inlineCode",{parentName:"p"},"nock")," and ",Object(i.b)("inlineCode",{parentName:"p"},"isomorphic-unfetch"),"."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"ts-jest")," is a TypeScript preprocessor for Jest to test projects written in TypeScript.",Object(i.b)("br",{parentName:"li"}),Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://kulshekhar.github.io/ts-jest/"}),"Refer to official documentation for detailed usage. ","\u2192")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"nock")," is a HTTP server mocking library. We use it to mock requests in our tests.",Object(i.b)("br",{parentName:"li"}),Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/nock/nock#nock"}),"Refer to official documentation for detailed usage. ","\u2192")),Object(i.b)("li",{parentName:"ul"},"While Next.js comes with a built-in polyfill for ",Object(i.b)("inlineCode",{parentName:"li"},"fetch"),"; We still need to add one for our Jest environment.")),Object(i.b)("h2",{id:"implementation"},"Implementation"),Object(i.b)("p",null,"You can see how ",Object(i.b)("strong",{parentName:"p"},"superplate"),"'s Jest plugin is implemented below."),Object(i.b)("h3",{id:"jestconfigjs"},Object(i.b)("inlineCode",{parentName:"h3"},"jest.config.js")),Object(i.b)("p",null,"We need to configure Jest to work with our environment. We'll be doing this in ",Object(i.b)("inlineCode",{parentName:"p"},"test/jest.config.js")," with the following code;"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js",metastring:'title="test/jest.config.js"',title:'"test/jest.config.js"'}),'const { pathsToModuleNameMapper } = require("ts-jest/utils");\nconst { compilerOptions } = require("../tsconfig.json");\n\nconst paths = compilerOptions.paths ? compilerOptions.paths : {};\n\nmodule.exports = {\n    rootDir: "../",\n    setupFilesAfterEnv: ["<rootDir>/test/jest.setup.js"],\n    testPathIgnorePatterns: ["<rootDir>/.next/", "<rootDir>/node_modules/"],\n    moduleNameMapper: {\n        ...pathsToModuleNameMapper(paths, { prefix: "<rootDir>/" }),\n        "\\\\.(scss|sass|css)$": "identity-obj-proxy",\n    },\n};\n')),Object(i.b)("p",null,"What we basically do is;"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Specifying a root directory for tests"),Object(i.b)("li",{parentName:"ul"},"Path to our Setup configuration for the testing environment"),Object(i.b)("li",{parentName:"ul"},"Mapping our ",Object(i.b)("inlineCode",{parentName:"li"},"tsconfig")," paths to jest"),Object(i.b)("li",{parentName:"ul"},"Mocking styles to prevent Jest to throw an error ")),Object(i.b)("h3",{id:"jestsetupjs"},Object(i.b)("inlineCode",{parentName:"h3"},"jest.setup.js")),Object(i.b)("p",null,"We need to apply the polyfill for the ",Object(i.b)("inlineCode",{parentName:"p"},"fetch"),", set environment variables to use in tests and setup ",Object(i.b)("inlineCode",{parentName:"p"},"nock")," to prevent memory leaks. We'll place this setup in ",Object(i.b)("inlineCode",{parentName:"p"},"test/jest.setup.js")," with the following code;"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js",metastring:'title="test/jest.setup.js"',title:'"test/jest.setup.js"'}),'import "isomorphic-unfetch";\nimport nock from "nock";\nimport dotenv from "dotenv";\n\ndotenv.config({ path: ".env.test" });\n\nafterAll(() => {\n    nock.cleanAll();\n    nock.restore();\n});\n')),Object(i.b)("h3",{id:"running-tests"},"Running Tests"),Object(i.b)("p",null,"We need to specify our config file when running jest, we can do this with ",Object(i.b)("inlineCode",{parentName:"p"},"jest -c test/jest.config.js"),". We will add this command to ",Object(i.b)("inlineCode",{parentName:"p"},"package.json")," as a test script. "),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json",metastring:'title="package.json"',title:'"package.json"'}),'{\n    "scripts": {\n        "test": "jest -c test/jest.config.js"\n    },\n}\n')),Object(i.b)("h3",{id:"example-test"},"Example Test"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="add.ts"',title:'"add.ts"'}),"// This is an example function to test\nexport const const add = (...nums: number[]) => {\n  return nums.reduce((acc, curr) =>  acc + curr, 0);\n}\n")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts",metastring:'title="add.spec.ts"',title:'"add.spec.ts"'}),'import { add } from "./add";\n\ndescribe("Add Function", () => {\n  it("1 + 2 + 3 = 6", () => {\n    expect(add(1,2,3)).toEqual(6);\n  });\n});\n')),Object(i.b)("h2",{id:"adding-jest-to-your-project-later"},"Adding Jest to your project later"),Object(i.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"All this work will be handled automatically by superplate, so you don\u2019t need to do anything extra as long as you choose Jest as testing plugin during the project creation phase."))),Object(i.b)("p",null,"If you want to add Jest to your existing project first install dependencies: "),Object(i.b)(o.a,{defaultValue:"npm",values:[{label:"npm",value:"npm"},{label:"yarn",value:"yarn"}],mdxType:"Tabs"},Object(i.b)(s.a,{value:"npm",mdxType:"TabItem"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"npm i -D jest ts-jest identity-obj-proxy nock isomorphic-unfetch dotenv \n"))),Object(i.b)(s.a,{value:"yarn",mdxType:"TabItem"},Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"yarn add -D jest ts-jest identity-obj-proxy nock isomorphic-unfetch dotenv\n")))),Object(i.b)("p",null,"Then you can follow documentations for detail usage"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Jest's ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://jestjs.io/docs/en/getting-started"}),"documentation")),Object(i.b)("li",{parentName:"ul"},"ts-jest's ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://kulshekhar.github.io/ts-jest/docs/installation"}),"documentation")),Object(i.b)("li",{parentName:"ul"},"Next.js and Jest ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/vercel/next.js/tree/canary/examples/with-jest"}),"example repository"))))}b.isMDXComponent=!0},157:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return j}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=p(n),d=a,j=u["".concat(o,".").concat(d)]||u[d]||b[d]||i;return n?r.a.createElement(j,s(s({ref:t},l),{},{components:n})):r.a.createElement(j,s({ref:t},l))}));function j(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},158:function(e,t,n){"use strict";function a(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}t.a=function(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(r&&(r+=" "),r+=t);return r}},159:function(e,t,n){"use strict";var a=n(0),r=n(160);t.a=function(){var e=Object(a.useContext)(r.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},160:function(e,t,n){"use strict";var a=n(0),r=Object(a.createContext)(void 0);t.a=r},161:function(e,t,n){"use strict";var a=n(0),r=n.n(a),i=n(159),o=n(158),s=n(55),c=n.n(s),l=37,p=39;t.a=function(e){var t=e.lazy,n=e.block,s=e.defaultValue,u=e.values,b=e.groupId,d=e.className,j=Object(i.a)(),m=j.tabGroupChoices,f=j.setTabGroupChoices,O=Object(a.useState)(s),h=O[0],g=O[1],v=a.Children.toArray(e.children);if(null!=b){var y=m[b];null!=y&&y!==h&&u.some((function(e){return e.value===y}))&&g(y)}var N=function(e){g(e),null!=b&&f(b,e)},w=[];return r.a.createElement("div",null,r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(o.a)("tabs",{"tabs--block":n},d)},u.map((function(e){var t=e.value,n=e.label;return r.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":h===t,className:Object(o.a)("tabs__item",c.a.tabItem,{"tabs__item--active":h===t}),key:t,ref:function(e){return w.push(e)},onKeyDown:function(e){!function(e,t,n){switch(n.keyCode){case p:!function(e,t){var n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()}(e,t);break;case l:!function(e,t){var n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()}(e,t)}}(w,e.target,e)},onFocus:function(){return N(t)},onClick:function(){N(t)}},n)}))),t?Object(a.cloneElement)(v.filter((function(e){return e.props.value===h}))[0],{className:"margin-vert--md"}):r.a.createElement("div",{className:"margin-vert--md"},v.map((function(e,t){return Object(a.cloneElement)(e,{key:t,hidden:e.props.value!==h})}))))}},162:function(e,t,n){"use strict";var a=n(3),r=n(0),i=n.n(r);t.a=function(e){var t=e.children,n=e.hidden,r=e.className;return i.a.createElement("div",Object(a.a)({role:"tabpanel"},{hidden:n,className:r}),t)}}}]);